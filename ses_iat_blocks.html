
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>SES-IAT: Arm vs. Reich</title>
  <script src="https://unpkg.com/jspsych@7.3.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload"></script>
  <script src="https://unpkg.com/@jspsych/plugin-call-function"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 2em; }
    .stimulus { font-size: 32px; }
    .categories { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 2em; }
  </style>
</head>
<body>
  <div id="jspsych-target"></div>

  <script>
    const jsPsych = initJsPsych();

    const armWords = ["Arbeitslosigkeit", "Betteln", "Gemeindebau", "Sozialhilfe"];
    const reichWords = ["Luxus", "Privatschule", "Geld", "Villa"];
    const guteWorte = ["Freude", "Liebe", "Wertvoll", "Erfolg"];
    const schlechteWorte = ["Leid", "Versagen", "Schmutz", "Schmerz"];

    const preload = {
      type: jsPsychPreload,
      images: []
    };

    const instructions = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <h2>SES-IAT</h2>
        <p>Sie sehen gleich Wörter, die Sie zwei Kategorien zuordnen sollen.</p>
        <p>Nutzen Sie die Taste <strong>E</strong> für die linke Kategorie und <strong>I</strong> für die rechte.</p>
        <p>Bitte reagieren Sie so schnell und genau wie möglich.</p>
        <p>Drücken Sie eine beliebige Taste, um zu starten.</p>
      `
    };

    function buildTrial(stimuli, leftCats, rightCats) {
      return {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: function() {
          const stim = jsPsych.timelineVariable('stimulus', true);
          return `
            <div class="categories">
              <div>${leftCats.join(" / ")}</div>
              <div>${rightCats.join(" / ")}</div>
            </div>
            <div class="stimulus">${stim}</div>
          `;
        },
        choices: ['e', 'i'],
        data: {
          category: function() { return jsPsych.timelineVariable('category', true); }
        }
      };
    }

    function makeStimuli(wordList, label) {
      return wordList.map(w => ({ stimulus: w, category: label }));
    }

    const practiceStimuli = jsPsych.randomization.sampleWithoutReplacement(
      makeStimuli(armWords, "Arm").concat(makeStimuli(reichWords, "Reich")),
      8
    );

    const block1Stimuli = jsPsych.randomization.sampleWithoutReplacement(
      makeStimuli(armWords, "Arm").concat(makeStimuli(guteWorte, "Gut"), makeStimuli(reichWords, "Reich"), makeStimuli(schlechteWorte, "Schlecht")),
      20
    );

    const block2Stimuli = jsPsych.randomization.sampleWithoutReplacement(
      makeStimuli(armWords, "Arm").concat(makeStimuli(schlechteWorte, "Schlecht"), makeStimuli(reichWords, "Reich"), makeStimuli(guteWorte, "Gut")),
      20
    );

    const timeline = [];

    timeline.push(preload);
    timeline.push(instructions);

    timeline.push({
      timeline: [buildTrial(practiceStimuli, ["Arm"], ["Reich"])],
      timeline_variables: practiceStimuli
    });

    timeline.push({
      type: jsPsychHtmlKeyboardResponse,
      stimulus: "<p>Block 1: Arm + Gut (E) vs. Reich + Schlecht (I)<br>Drücken Sie eine Taste, um zu starten.</p>"
    });

    timeline.push({
      timeline: [buildTrial(block1Stimuli, ["Arm", "Gut"], ["Reich", "Schlecht"])],
      timeline_variables: block1Stimuli
    });

    timeline.push({
      type: jsPsychHtmlKeyboardResponse,
      stimulus: "<p>Block 2: Arm + Schlecht (E) vs. Reich + Gut (I)<br>Drücken Sie eine Taste, um zu starten.</p>"
    });

    timeline.push({
      timeline: [buildTrial(block2Stimuli, ["Arm", "Schlecht"], ["Reich", "Gut"])],
      timeline_variables: block2Stimuli
    });

    timeline.push({
      type: jsPsychCallFunction,
      func: function() {
        jsPsych.data.addProperties({ finished: true });
      }
    });

    timeline.push({
      type: jsPsychHtmlKeyboardResponse,
      stimulus: "<h3>Vielen Dank für Ihre Teilnahme!</h3><p>Drücken Sie eine Taste zum Beenden.</p>"
    });

    jsPsych.run(timeline);
  </script>
</body>
</html>
